<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تم الحجز بنجاح - مجمع فينكس الطبي</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body { 
      font-family: 'Cairo', Arial, Tahoma, sans-serif; 
      background: #faf6ee; 
      min-height: 100vh; 
      margin: 0;
      display:flex;
      flex-direction:column;
    }
    .success-container {
      max-width: 390px;
      margin: 60px auto 30px auto;
      background: #fff;
      border-radius: 21px;
      box-shadow: 0 4px 36px #e2be6d2f;
      padding: 28px 10px 20px 10px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .success-check {
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg,#e9be4f,#eadcbc 80%);
      width: 64px; height: 64px;
      border-radius: 50%;
      margin: 0 auto 13px auto;
      box-shadow: 0 3px 19px #e2be6d44;
      animation: pop 0.7s;
    }
    .success-check i {
      color: #fff;
      font-size: 2.1em;
      animation: bounce 1.1s;
    }
    @keyframes pop {
      0% { transform: scale(0.2);}
      60% { transform: scale(1.2);}
      100% { transform: scale(1);}
    }
    @keyframes bounce {
      0% { transform: scale(0);}
      80% { transform: scale(1.25);}
      100% { transform: scale(1);}
    }
    .success-container h2 {
      color: #b89023;
      font-size: 1.45em;
      margin-bottom: 9px;
      font-weight: bold;
      letter-spacing: 1px;
      background: #fdf4dd;
      border-radius: 10px;
      padding: 5px 0;
      margin-top: 8px;
    }
    .details-box {
      background: #f7f5ee;
      border-radius: 10px;
      text-align: right;
      margin: 16px auto 10px auto;
      padding: 10px 8px;
      font-size: 0.93em;
      color: #7a6741;
      direction: rtl;
      box-shadow: 0 2px 10px #2fa4c61c;
      border: 1.3px solid #e8ca7c35;
      font-weight: bold;
      min-height: 95px;
      max-width: 260px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .details-box div {
      word-break: break-word;
      font-weight: 600;
      line-height: 1.6;
    }
    .done-msg {
      color: #000000;
      font-weight: bold;
      font-size: 1em;
      margin-top: 10px;
      margin-bottom: 6px;
      letter-spacing: 0.2px;
      text-align: center;
      line-height: 1.7;
      min-height: 1.5em;
    }
    .social-icons {
      display: flex;
      justify-content: center;
      gap: 7px;
      margin: 15px 0 0 0;
    }
    .social-icons a {
      font-size: 1em;
      padding: 0 3px;
      border-radius: 50%;
      background: #fff3ce;
      color: #b89023;
      border: 1.2px solid #f9e9c8;
      transition: background 0.19s, color 0.19s;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .social-icons a:hover { background: #fffbe7; color: #84610f; }
    .home-btn {
      background: var(--gold-gradient, linear-gradient(90deg,#e9be4f 60%,#eadcbc 110%));
      color: #fff;
      font-weight: bold;
      padding: 9px 0;
      border-radius: 10px;
      border: none;
      width: 100%;
      font-size: 1.04em;
      cursor: pointer;
      box-shadow: 0 1px 12px #e2be6d54;
      margin-top: 15px;
      transition: background 0.18s;
    }
    .home-btn:hover { background: linear-gradient(90deg, #f9dc8c 0%, #e8ca7c 100%); color: #805500;}
    @media (max-width: 600px) {
      .success-container { padding: 3vw 0vw 4vw 0vw; max-width: 98vw;}
      .success-check { width: 45px; height: 45px;}
      .success-check i { font-size: 1.4em;}
      .details-box { font-size: 0.93em; max-width: 97vw;}
    }
    footer {
      background: rgba(255,255,255,0.219) !important;
      color: #b89023 !important;
      text-align: center;
      font-size: 1em;
      font-weight: bold;
      border-top: 1.5px solid #eee;
      letter-spacing: 0.6px;
      padding: 12px 0 9px 0;
      margin-top: auto;
      box-shadow: 0 -2px 12px #e2be6d54;
    }
  </style>
</head>
<body>
  <div class="success-container">
    <div class="success-check">
      <i class="fa fa-check"></i>
    </div>
    <h2>تم الحجز بنجاح!</h2>
    <div class="details-box" id="details"></div>
    <div class="done-msg" id="statusMsg"></div>
    <button class="home-btn" onclick="window.location.href='index.html'">
      العودة للصفحة الرئيسية
    </button>
    <div class="social-icons">
      <a href="https://wa.me/966531422555" target="_blank" title="واتساب"><i class="fab fa-whatsapp"></i></a>
      <a href="https://www.instagram.com/phoenix.shq/" target="_blank" title="انستقرام"><i class="fab fa-instagram"></i></a>
      <a href="https://www.snapchat.com/add/phoenix.shq?share_id=VOXDQhmXrWw&locale=ar-AE" target="_blank" title="سناب شات"><i class="fab fa-snapchat-ghost"></i></a>
    </div>
  </div>
  <footer>
    جميع الحقوق محفوظة © مجمع فينكس الطبي 2025
  </footer>

  <script>
    // تنسيق الوقت القادم من قيمة الراديو (date*time) مثل: 01-10-2025*16:30
    function formatTimeValue(raw) {
      try {
        if(!raw) return '';
        const [datePart, timePart=''] = raw.split('*');
        const [day, month, year] = (datePart || '').split('-');
        const [h='0', m='0'] = (timePart || '').split(':');
        const hour = parseInt(h,10), minute = parseInt(m,10);
        const ampm = hour < 12 ? 'صباحاً' : 'مساءً';
        let hour12 = hour % 12; if (hour12 === 0) hour12 = 12;

        let displayDate = raw;
        if(day && month && year){
          const dateObj = new Date(`${year}-${String(month).padStart(2,'0')}-${String(day).padStart(2,'0')}`);
          const weekDays = ['الأحد','الإثنين','الثلاثاء','الأربعاء','الخميس','الجمعة','السبت'];
          const dayName = weekDays[dateObj.getDay()];
          displayDate = `${year}-${String(month).padStart(2,'0')}-${String(day).padStart(2,'0')} (${dayName})`;
        }
        return `${displayDate} ${hour12}:${String(minute).padStart(2,'0')} ${ampm}`;
      } catch {
        return raw;
      }
    }

    // ==== قراءة البيانات مع بدائل آمنة ====
    // الاسم والجوال قد يكونان محفوظين باسمَي auth_* إذا لم تُستخدم صفحة التأكيد الوسيطة
    const name   = localStorage.getItem('pending_name')   || localStorage.getItem('auth_name')  || '';
    const phone  = localStorage.getItem('pending_phone')  || localStorage.getItem('auth_phone') || '';
    const clinic = localStorage.getItem('pending_clinic_label') || localStorage.getItem('pending_clinic') || '';
    const month  = localStorage.getItem('pending_month')  || ''; // إن لم يوجد سيُترك فارغًا
    const time   = localStorage.getItem('pending_time')   || '';

    // عرض التفاصيل
    document.getElementById('details').innerHTML = `
      <div><strong>الاسم:</strong> ${name || '—'}</div>
      <div><strong>رقم الجوال:</strong> ${phone || '—'}</div>
      <div><strong>العيادة:</strong> ${clinic || '—'}</div>
      <div><strong>الشهر:</strong> ${month || '—'}</div>
      <div><strong>الوقت:</strong> ${time ? formatTimeValue(time) : '—'}</div>
    `;

    // رسالة الخادم (من /api/book) إن وُجدت
    const srvMsg = localStorage.getItem('booking_result_msg');
    document.getElementById('statusMsg').textContent = srvMsg || '🚀 تم استلام بياناتك وسيتم تأكيد الحجز عبر النظام.';

    // ===== تتبّع النجاح (بدون إزعاج المستخدم) =====
    (async () => {
      try {
        await fetch('/api/track-success', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ clinic: clinic || '', month: month || '' })
        });
      } catch (e) {
        console.warn('track-success failed', e);
      }
    })();

    // تنظيف القيم بعد العرض (اترك auth_* لأنها تُستخدم لاحقًا في الجلسة)
    localStorage.removeItem('booking_result_msg');
    localStorage.removeItem('pending_name');
    localStorage.removeItem('pending_phone');
    localStorage.removeItem('pending_clinic');
    localStorage.removeItem('pending_clinic_label');
    localStorage.removeItem('pending_month');
    localStorage.removeItem('pending_time');

    // تحويل تلقائي للرئيسية بعد 10 ثوانٍ
    setTimeout(() => { window.location.href = "index.html"; }, 10000);
  </script>
</body>
</html>
