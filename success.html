<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØªÙ… Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­ - Ù…Ø¬Ù…Ø¹ ÙÙŠÙ†ÙƒØ³ Ø§Ù„Ø·Ø¨ÙŠ</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body{font-family:'Cairo',Arial,Tahoma,sans-serif;background:#faf6ee;min-height:100vh;margin:0;display:flex;flex-direction:column;}
    .success-container{max-width:390px;margin:60px auto 30px;background:#fff;border-radius:21px;box-shadow:0 4px 36px #e2be6d2f;padding:28px 10px 20px;text-align:center;position:relative;overflow:hidden;}
    .success-check{display:flex;justify-content:center;align-items:center;background:linear-gradient(135deg,#e9be4f,#eadcbc 80%);width:64px;height:64px;border-radius:50%;margin:0 auto 13px;box-shadow:0 3px 19px #e2be6d44;animation:pop .7s}
    .success-check i{color:#fff;font-size:2.1em;animation:bounce 1.1s}
    @keyframes pop{0%{transform:scale(.2)}60%{transform:scale(1.2)}100%{transform:scale(1)}}
    @keyframes bounce{0%{transform:scale(0)}80%{transform:scale(1.25)}100%{transform:scale(1)}}
    h2{color:#b89023;font-size:1.45em;margin:8px 0 9px;font-weight:700;letter-spacing:1px;background:#fdf4dd;border-radius:10px;padding:5px 0}
    .details-box{background:#f7f5ee;border-radius:10px;text-align:right;margin:16px auto 10px;padding:10px 8px;font-size:.93em;color:#7a6741;direction:rtl;box-shadow:0 2px 10px #2fa4c61c;border:1.3px solid #e8ca7c35;font-weight:700;min-height:95px;max-width:260px;display:flex;flex-direction:column;gap:4px}
    .details-box div{word-break:break-word;font-weight:600;line-height:1.6}
    .done-msg{color:#000;font-weight:700;font-size:1em;margin:10px 0 6px;letter-spacing:.2px;text-align:center;line-height:1.7;min-height:1.5em}
    .hint{color:#6b5a33;font-size:.9em;margin-top:6px}
    .social-icons{display:flex;justify-content:center;gap:7px;margin:15px 0 0}
    .social-icons a{font-size:1em;padding:0 3px;border-radius:50%;background:#fff3ce;color:#b89023;border:1.2px solid #f9e9c8;transition:.19s;width:28px;height:28px;display:flex;align-items:center;justify-content:center}
    .social-icons a:hover{background:#fffbe7;color:#84610f}
    .home-btn{background:var(--gold-gradient,linear-gradient(90deg,#e9be4f 60%,#eadcbc 110%));color:#fff;font-weight:700;padding:9px 0;border-radius:10px;border:none;width:100%;font-size:1.04em;cursor:pointer;box-shadow:0 1px 12px #e2be6d54;margin-top:15px;transition:background .18s}
    .home-btn:hover{background:linear-gradient(90deg,#f9dc8c 0%,#e8ca7c 100%);color:#805500}
    @media(max-width:600px){.success-container{padding:3vw 0 4vw;max-width:98vw}.success-check{width:45px;height:45px}.success-check i{font-size:1.4em}.details-box{font-size:.93em;max-width:97vw}}
    footer{background:rgba(255,255,255,.219)!important;color:#b89023!important;text-align:center;font-size:1em;font-weight:700;border-top:1.5px solid #eee;letter-spacing:.6px;padding:12px 0 9px;margin-top:auto;box-shadow:0 -2px 12px #e2be6d54}
  </style>
</head>
<body>
  <div class="success-container">
    <div class="success-check"><i class="fa fa-check"></i></div>
    <h2>ØªÙ… Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­!</h2>

    <div class="details-box" id="details"></div>
    <div class="done-msg" id="statusMsg"></div>
    <div class="hint" id="chainHint" style="display:none;"></div>

    <button class="home-btn" onclick="window.location.href='index.html'">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <div class="social-icons">
      <a href="https://wa.me/966531422555" target="_blank" title="ÙˆØ§ØªØ³Ø§Ø¨"><i class="fab fa-whatsapp"></i></a>
      <a href="https://www.instagram.com/phoenix.shq/" target="_blank" title="Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù…"><i class="fab fa-instagram"></i></a>
      <a href="https://www.snapchat.com/add/phoenix.shq?share_id=VOXDQhmXrWw&locale=ar-AE" target="_blank" title="Ø³Ù†Ø§Ø¨ Ø´Ø§Øª"><i class="fab fa-snapchat-ghost"></i></a>
    </div>
  </div>

  <footer>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© Ù…Ø¬Ù…Ø¹ ÙÙŠÙ†ÙƒØ³ Ø§Ù„Ø·Ø¨ÙŠ 2025</footer>

  <script>
    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª (ÙŠØ¯Ø¹Ù…: YYYY-MM-DD*HH:MM Ùˆ DD-MM-YYYY*HH:MM)
    function formatTimeValue(raw){
      try{
        if(!raw) return '';
        const [datePart, timePart=''] = raw.split('*');
        let Y, M, D;

        // 1) YYYY-MM-DD
        const m1 = /^(\d{4})-(\d{1,2})-(\d{1,2})$/.exec(datePart);
        // 2) DD-MM-YYYY
        const m2 = /^(\d{1,2})-(\d{1,2})-(\d{4})$/.exec(datePart);

        if (m1) { Y = +m1[1]; M = +m1[2]; D = +m1[3]; }
        else if (m2) { Y = +m2[3]; M = +m2[2]; D = +m2[1]; }
        else {
          return raw; // ØµÙŠØºØ© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©
        }

        const [h='0', m='0'] = timePart.split(':');
        const hour = parseInt(h,10), minute = parseInt(m,10);

        // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø³ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ù„Ø¬Ù‡Ø§Ø²
        const dateObj = new Date(Y, M-1, D);
        const weekDays = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];
        const dayName = weekDays[dateObj.getDay()];

        const ampm = hour < 12 ? 'ØµØ¨Ø§Ø­Ø§Ù‹' : 'Ù…Ø³Ø§Ø¡Ù‹';
        let hour12 = hour % 12; if(hour12===0) hour12 = 12;

        const displayDate = `${Y}-${String(M).padStart(2,'0')}-${String(D).padStart(2,'0')} (${dayName})`;
        return `${displayDate} ${hour12}:${String(minute).padStart(2,'0')} ${ampm}`;
      } catch {
        return raw;
      }
    }

    // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨/Ù…Ø¹Ø±Ù Ø·ÙˆÙŠÙ„ Ù…Ù† Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…
    function sanitizeBookingMsg(msg){
      if(!msg) return '';
      let s = String(msg);
      s = s.replace(/Ø¨Ø§Ù„Ø­Ø³Ø§Ø¨\s*:\s*[\d\w_-]+/g,'').trim();
      s = s.replace(/\b\d{6,}\b/g,'').trim();
      s = s.replace(/\s{2,}/g,' ').replace(/[ØŒ,:;]\s*[ØŒ,:;]+/g,',').trim();
      if(!s) s = 'âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­.';
      return s;
    }

    // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage
    const nationalId = localStorage.getItem('pending_identity') || localStorage.getItem('auth_identity') || '';
    const phone      = localStorage.getItem('pending_phone')    || localStorage.getItem('auth_phone')    || '';
    const clinicLbl  = localStorage.getItem('pending_clinic_label') || localStorage.getItem('pending_clinic') || '';
    const monthVal   = localStorage.getItem('pending_month')    || '';
    const timeVal    = localStorage.getItem('pending_time')     || '';
    const note       = localStorage.getItem('pending_note')     || '';
    const slotsCount = parseInt(localStorage.getItem('pending_slots') || '0', 10);

    // Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
    const detailsEl = document.getElementById('details');
    const rows = [
      ['Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©/Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©', nationalId || 'â€”'],
      ['Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„',         phone      || 'â€”'],
      ['Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©',            clinicLbl  || 'â€”'],
      ['Ø§Ù„Ø´Ù‡Ø±',              monthVal   || 'â€”'],
      ['Ø§Ù„ÙˆÙ‚Øª',              timeVal ? formatTimeValue(timeVal) : 'â€”']
    ];
    if (note) rows.push(['Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©', note]);
    if (!isNaN(slotsCount) && slotsCount > 1) rows.push(['Ø¹Ø¯Ø¯ Ø§Ù„Ø®Ø§Ù†Ø§Øª', String(slotsCount)]);
    detailsEl.innerHTML = rows.map(([k,v])=>`<div><strong>${k}:</strong> ${v}</div>`).join('');

    // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…
    const rawMsg  = localStorage.getItem('booking_result_msg') || '';
    const safeMsg = sanitizeBookingMsg(rawMsg);
    document.getElementById('statusMsg').textContent = safeMsg || 'ğŸš€ ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ³ÙŠØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² Ø¹Ø¨Ø± Ø§Ù„Ù†Ø¸Ø§Ù….';

    // ØªÙ„Ù…ÙŠØ­ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ØªØ³Ù„Ø³Ù„
    const chainHint = document.getElementById('chainHint');
    if (!isNaN(slotsCount) && slotsCount > 1) {
      chainHint.style.display = '';
      chainHint.textContent = `Ø³ÙŠÙ‚ÙˆÙ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø¥ÙƒÙ…Ø§Ù„ ${slotsCount - 1} Ø®Ø§Ù†Ø© Ø¥Ø¶Ø§ÙÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©ØŒ Ù„Ø§ ÙŠÙ„Ø²Ù… Ø£ÙŠ Ø¥Ø¬Ø±Ø§Ø¡ Ù…Ù† Ø·Ø±ÙÙƒ.`;
    }

    // ØªØªØ¨Ù‘Ø¹ Ø§Ù„Ù†Ø¬Ø§Ø­
    (async ()=>{
      try{
        
      }catch(e){ console.warn('track-success failed', e); }
    })();

    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø¤Ù‚ØªØ©
    [
      'booking_result_msg','pending_identity','pending_phone','pending_clinic',
      'pending_clinic_label','pending_month','pending_time','pending_note','pending_slots'
    ].forEach(k=>localStorage.removeItem(k));

    // Ø±Ø¬ÙˆØ¹ ØªÙ„Ù‚Ø§Ø¦ÙŠ
    setTimeout(()=>{ window.location.href='index.html'; }, 10000);
  </script>
</body>
</html>
