<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>لوحة التحكم | فينكس</title>
  <style>
    body{font-family:Cairo,Arial,sans-serif;background:#f6f7f9;margin:0}
    .wrap{max-width:1100px;margin:24px auto;padding:16px}
    h1{margin:0 0 12px}
    .tabs{display:flex;gap:8px;margin:12px 0}
    .tabs button{padding:8px 14px;border-radius:999px;border:1px solid #ddd;background:#fff;cursor:pointer}
    .tabs button.active{background:#111;color:#fff}
    .panel{display:none;background:#fff;border:1px solid #e6e6e6;border-radius:12px;padding:16px}
    .panel.active{display:block}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .card{border:1px solid #eee;border-radius:12px;padding:10px;width:180px}
    .card img{width:100%;height:140px;object-fit:contain;background:#fafafa;border-radius:8px}
    .danger{background:#ffeded;border:1px solid #ffd1d1;color:#b00000}
    .btn{padding:6px 10px;border-radius:8px;border:1px solid #ddd;background:#fff;cursor:pointer}
    .btn.primary{background:#111;color:#fff;border-color:#111}
    .top{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    input[type="text"], input[type="password"]{padding:8px;border-radius:8px;border:1px solid #ddd}
  </style>
</head>
<body>
<div class="wrap">
  <h1>لوحة التحكم</h1>

  <div class="top">
    <input id="key" type="password" placeholder="STAFF_KEY">
    <span>أدخل المفتاح ثم ابدأ</span>
  </div>

  <div class="tabs">
    <button id="tabB" class="active">البنرات</button>
    <button id="tabP">الباقات</button>
  </div>

  <!-- البنرات -->
  <section id="panelB" class="panel active">
    <h3>إضافة بنر</h3>
    <input id="bannerFile" type="file" accept="image/*" multiple>

    <button class="btn primary" onclick="addBanner()">حفظ</button>
    <hr>
    <div id="banners" class="row"></div>
  </section>

  <!-- الباقات -->
  <section id="panelP" class="panel">
    <h3>إضافة باقة</h3>
    <input id="pkgTitle" type="text" placeholder="العنوان">
    <input id="pkgDesc" type="text" placeholder="الوصف">
    <input id="pkgFile" type="file" accept="image/*">
    <button class="btn primary" onclick="addPackage()">حفظ</button>
    <hr>
    <div id="packages" class="row"></div>
  </section>
</div>

<script>
const tabB = document.getElementById('tabB');
const tabP = document.getElementById('tabP');
const panelB = document.getElementById('panelB');
const panelP = document.getElementById('panelP');
tabB.onclick=()=>{tabB.classList.add('active');tabP.classList.remove('active');panelB.classList.add('active');panelP.classList.remove('active')}
tabP.onclick=()=>{tabP.classList.add('active');tabB.classList.remove('active');panelP.classList.add('active');panelB.classList.remove('active')}

function staffHeaders(){
  return { 'x-staff-key': document.getElementById('key').value };
}

async function loadAll(){
  const b = await fetch('/api/banners').then(r=>r.json());
  const p = await fetch('/api/packages').then(r=>r.json());
  renderBanners(b.banners||[]);
  renderPackages(p.packages||[]);
}
loadAll();

function renderBanners(list){
  const el = document.getElementById('banners'); el.innerHTML='';
  list.forEach(x=>{
    const c=document.createElement('div'); c.className='card';
    c.innerHTML=`<img src="${x.src}"><button class="btn danger" onclick="delBanner('${x.id}')">حذف</button>`;
    el.appendChild(c);
  });
}
function renderPackages(list){
  const el = document.getElementById('packages'); el.innerHTML='';
  list.forEach(x=>{
    const c=document.createElement('div'); c.className='card';
    c.innerHTML=`<img src="${x.img}">
      <div>${x.title}</div>
      <div style="opacity:.7">${x.desc||''}</div>
      <button class="btn danger" onclick="delPackage('${x.id}')">حذف</button>`;
    el.appendChild(c);
  });
}

async function addBanner(){
  const files = document.getElementById('bannerFile').files;
if(!files.length) return alert('اختر صورة أو أكثر');

const fd = new FormData();
for (const f of files) {
  fd.append('files', f);
}

  const r=await fetch('/api/admin/banners',{method:'POST',headers:staffHeaders(),body:fd});
  if(!r.ok) return alert('فشل');
  loadAll();
}
async function delBanner(id){
  if(!confirm('تأكيد الحذف؟')) return;
  await fetch('/api/admin/banners/'+id,{method:'DELETE',headers:staffHeaders()});
  loadAll();
}
async function addPackage(){
  const t=document.getElementById('pkgTitle').value.trim();
  const d=document.getElementById('pkgDesc').value.trim();
  const f=document.getElementById('pkgFile').files[0];
  if(!t||!f) return alert('العنوان والصورة مطلوبة');
  const fd=new FormData(); fd.append('file',f); fd.append('title',t); fd.append('desc',d);
  const r=await fetch('/api/admin/packages',{method:'POST',headers:staffHeaders(),body:fd});
  if(!r.ok) return alert('فشل');
  loadAll();
}
async function delPackage(id){
  if(!confirm('تأكيد الحذف؟')) return;
  await fetch('/api/admin/packages/'+id,{method:'DELETE',headers:staffHeaders()});
  loadAll();
}
</script>
</body>
</html>
