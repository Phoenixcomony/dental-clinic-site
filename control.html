<!DOCTYPE html>

<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | ÙÙŠÙ†ÙƒØ³</title>

  <!-- Google Font -->

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f7f9;
      --card:#ffffff;
      --text:#111111;
      --muted:#6b7280;
      --border:#e5e7eb;
      --primary:#111111;
      --danger:#b00000;
      --radius:16px;
      --shadow:0 10px 30px rgba(0,0,0,.06);
      --shadow-soft:0 6px 18px rgba(0,0,0,.05);
    }

    *{box-sizing:border-box}

    body{
      font-family:'Cairo',Arial,sans-serif;
      background:var(--bg);
      margin:0;
      color:var(--text);
    }

    .wrap{
      max-width:1200px;
      margin:32px auto;
      padding:20px;
    }

    /* ===== Header ===== */
    .header{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:20px 24px;
      display:flex;
      flex-direction:column;
      gap:14px;
      margin-bottom:20px;
    }

    .header-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:12px;
    }

    .title{
      font-size:22px;
      font-weight:700;
    }

    .auth-box{
      display:flex;
      align-items:center;
      gap:10px;
      background:#fafafa;
      border:1px solid var(--border);
      border-radius:999px;
      padding:6px 12px;
    }

    .auth-box span{font-size:14px;color:var(--muted)}

    .auth-box input{
      border:none;
      outline:none;
      background:transparent;
      font-family:inherit;
      padding:6px 8px;
      width:160px;
    }

    /* ===== Tabs ===== */
    .tabs{
      display:flex;
      gap:10px;
      background:#f0f1f3;
      padding:6px;
      border-radius:999px;
      width:fit-content;
    }

    .tabs button{
      border:none;
      background:transparent;
      padding:10px 22px;
      border-radius:999px;
      cursor:pointer;
      font-family:inherit;
      font-size:14px;
      color:var(--muted);
      transition:.25s ease;
    }

    .tabs button.active{
      background:var(--primary);
      color:#fff;
      box-shadow:var(--shadow-soft);
    }

    /* ===== Panels ===== */
    .panel{
      display:none;
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:22px;
      margin-top:20px;
      animation:fade .4s ease;
    }

    .panel.active{display:block}

    @keyframes fade{
      from{opacity:0;transform:translateY(10px)}
      to{opacity:1;transform:translateY(0)}
    }

    .panel h3{
      margin:0 0 6px;
      font-size:18px;
    }

    .panel .desc{
      font-size:13px;
      color:var(--muted);
      margin-bottom:16px;
    }

    /* ===== Forms ===== */
    .form-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:14px;
    }

    input[type="text"], input[type="password"], input[type="file"]{
      padding:10px 12px;
      border-radius:10px;
      border:1px solid var(--border);
      font-family:inherit;
      background:#fafafa;
    }

    /* ===== Buttons ===== */
    .btn{
      padding:10px 16px;
      border-radius:10px;
      border:1px solid var(--border);
      background:#fff;
      cursor:pointer;
      font-family:inherit;
      transition:.25s ease;
    }

    .btn:hover{transform:translateY(-1px)}

    .btn.primary{
      background:var(--primary);
      color:#fff;
      border-color:var(--primary);
    }

    .btn.danger{
      background:#ffeded;
      border:1px solid #ffd1d1;
      color:var(--danger);
    }

    /* ===== Grid ===== */
    .row{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(190px,1fr));
      gap:16px;
      margin-top:18px;
    }

    /* ===== Cards ===== */
    .card{
      background:#fff;
      border-radius:14px;
      box-shadow:var(--shadow-soft);
      padding:10px;
      position:relative;
      overflow:hidden;
      transition:.3s ease;
    }

    .card:hover{
      transform:translateY(-6px);
      box-shadow:0 18px 45px rgba(0,0,0,.08);
    }

    .card img{
      width:100%;
      height:150px;
      object-fit:contain;
      background:#fafafa;
      border-radius:10px;
    }

    .card .title{
      font-size:14px;
      font-weight:700;
      margin-top:8px;
    }

    .card .sub{
      font-size:12px;
      color:var(--muted);
    }

    .card .danger{
      position:absolute;
      top:8px;
      left:8px;
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
    }

    @media(max-width:600px){
      .auth-box{width:100%;justify-content:space-between}
      .tabs{width:100%}
      .tabs button{flex:1}
    }

  </style>

</head>
<body>

<div class="wrap">
  <!-- Ù…ÙØªØ§Ø­ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø¸Ø§Ù‡Ø± Ø¯Ø§Ø¦Ù…Ù‹Ø§) -->
<div class="auth-box">
  <span></span>
  <input id="key" type="password" placeholder="STAFF_KEY">
</div>

<!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚ÙÙ„ -->
<div id="adminApp" style="display:none">


  <!-- Header -->

  <div class="header">
    <div class="header-top">
      <div class="title">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© â€“ Ù…Ø¬Ù…Ø¹ ÙÙŠÙ†ÙƒØ³ Ø§Ù„Ø·Ø¨ÙŠ</div>
      


<div class="tabs">
  <button id="tabB" class="active">Ø§Ù„Ø¨Ù†Ø±Ø§Øª</button>
  <button id="tabP">Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</button>
  <button id="tabC">Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</button>
   <button id="tabD">Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</button>
</div>
  



  </div>

  <!-- Ø§Ù„Ø¨Ù†Ø±Ø§Øª -->

  <section id="panelB" class="panel active">
    <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ù†Ø±Ø§Øª</h3>
    <div class="desc">Ø±ÙØ¹ â€“ Ø¹Ø±Ø¶ â€“ Ø­Ø°Ù Ø§Ù„Ø¨Ù†Ø±Ø§Øª Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø±</div>


<div class="form-row">
  <input id="bannerFile" type="file" accept="image/*" multiple>
  <button class="btn primary" onclick="addBanner()">Ø­ÙØ¸ Ø§Ù„Ø¨Ù†Ø±Ø§Øª</button>
</div>

<div id="banners" class="row"></div>


  </section>
<!-- ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© -->
<section id="panelEditClinic" class="panel">
  <h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</h3>
  <div class="desc">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</div>

  <div class="form-row">
    <input id="eLabel" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©">
    <input id="eValue" type="text" placeholder="Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø¬Ø²">
    <input id="eFrom" type="time">
    <input id="eTo" type="time">
  </div>

  <label><input type="checkbox" id="eFriday"> Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¬Ù…Ø¹Ø©</label>
  <label><input type="checkbox" id="eSaturday"> Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø³Ø¨Øª</label>

  <br><br>
  <button class="btn primary" onclick="saveClinicEdit()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
  <button class="btn" onclick="backToClinics()">Ø±Ø¬ÙˆØ¹</button>
</section>

  <!-- Ø§Ù„Ø¨Ø§Ù‚Ø§Øª -->

  <section id="panelP" class="panel">
    <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</h3>
    <div class="desc">Ø¥Ø¶Ø§ÙØ© â€“ ØªØ¹Ø¯ÙŠÙ„ â€“ Ø­Ø°Ù Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠØ©</div>

<div class="form-row">
  <input id="pkgTitle" type="text" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø§Ù‚Ø©">
  <input id="pkgDesc" type="text" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ±">
  <input id="pkgFile" type="file" accept="image/*">
  <button class="btn primary" onclick="addPackage()">Ø­ÙØ¸ Ø§Ù„Ø¨Ø§Ù‚Ø©</button>
</div>

<div id="packages" class="row"></div>
</section> <!-- Ù†Ù‡Ø§ÙŠØ© panelP -->

<section id="panelD" class="panel">
  <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</h3>
  <div class="desc">Ø¥Ø¶Ø§ÙØ© â€“ ØªØ¹Ø¯ÙŠÙ„ â€“ Ø­Ø°Ù Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</div>

  <div class="form-row">
    <input id="docName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨">
    <input id="docDesc" type="text" placeholder="Ù†Ø¨Ø°Ø© Ù…Ø®ØªØµØ±Ø©">
    <input id="docFile" type="file" accept="image/*">
    <button class="btn primary" onclick="addDoctor()">Ø­ÙØ¸ Ø§Ù„Ø·Ø¨ÙŠØ¨</button>
  </div>

  <div id="doctors" class="row"></div>
</section>


  </section>
  <!-- Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª -->
<section id="panelC" class="panel">
  <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</h3>
  <div class="desc">Ø¥Ø¶Ø§ÙØ© â€“ ØªØ­Ø¯ÙŠØ¯ ÙˆÙ‚Øª â€“ Ø­Ø°Ù Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</div>

  <div class="form-row">
    <input id="cLabel" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©">
    <input id="cValue" type="text" placeholder="Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø¬Ø² (Imdad)">
    <input id="cFrom" type="time">
    <input id="cTo" type="time">
    <button class="btn primary" onclick="addClinic()">Ø­ÙØ¸ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</button>
    <label style="display:flex;align-items:center;gap:6px;font-size:14px">
  <input type="checkbox" id="cAllowFriday">
  Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø©
</label>

<label style="display:flex;align-items:center;gap:6px;font-size:14px">
  <input type="checkbox" id="cAllowSaturday">
  Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ÙŠÙˆÙ… Ø§Ù„Ø³Ø¨Øª
</label>

  </div>

  <div id="clinics" class="row"></div>
</section>


</div>
</div> <!-- Ù†Ù‡Ø§ÙŠØ© adminApp -->

<script>
const tabB = document.getElementById('tabB');
const tabP = document.getElementById('tabP');
const panelB = document.getElementById('panelB');
const panelP = document.getElementById('panelP');
const tabC = document.getElementById('tabC');
const tabD = document.getElementById('tabD');
const panelD = document.getElementById('panelD');
const panelC = document.getElementById('panelC');
const panelEditClinic = document.getElementById('panelEditClinic');


tabB.onclick=()=>{
  tabB.classList.add('active');
  tabP.classList.remove('active');
  tabC.classList.remove('active');

  panelB.classList.add('active');
  panelP.classList.remove('active');
  panelC.classList.remove('active');
}


tabP.onclick=()=>{
  tabP.classList.add('active');
  tabB.classList.remove('active');
  tabC.classList.remove('active');

  panelP.classList.add('active');
  panelB.classList.remove('active');
  panelC.classList.remove('active');
}

tabC.onclick=()=>{
  tabC.classList.add('active');
  tabB.classList.remove('active');
  tabP.classList.remove('active');
  panelC.classList.add('active');
  panelB.classList.remove('active');
  panelP.classList.remove('active');
}
tabD.onclick=()=>{
  [tabB,tabP,tabC].forEach(t=>t.classList.remove('active'));
  [panelB,panelP,panelC].forEach(p=>p.classList.remove('active'));

  tabD.classList.add('active');
  panelD.classList.add('active');

  loadDoctors();
};


function staffHeaders(){
  return { 'x-staff-key': document.getElementById('key').value };
}

async function loadAll(){
  const b = await fetch('/api/banners').then(r=>r.json());
  const p = await fetch('/api/packages').then(r=>r.json());
  renderBanners(b.banners||[]);
  renderPackages(p.packages||[]);
  loadClinicsAdmin();
}
loadAll();

function renderBanners(list){
  const el = document.getElementById('banners'); el.innerHTML='';
  list.forEach(x=>{
    const c=document.createElement('div'); c.className='card';
    c.innerHTML=`<img src="${x.src}"><button class="btn danger" onclick="delBanner('${x.id}')">Ø­Ø°Ù</button>`;
    el.appendChild(c);
  });
}

function renderPackages(list){
  const el = document.getElementById('packages'); el.innerHTML='';
  list.forEach(x=>{
    const c=document.createElement('div'); c.className='card';
    c.innerHTML=`<img src="${x.img}">
      <div class="title">${x.title}</div>
      <div class="sub">${x.desc||''}</div>
      <button class="btn danger" onclick="delPackage('${x.id}')">Ø­Ø°Ù</button>`;
    el.appendChild(c);
  });
}

async function addBanner(){
  const files = document.getElementById('bannerFile').files;
  if(!files.length) return alert('Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø£Ùˆ Ø£ÙƒØ«Ø±');

  const fd = new FormData();
  for (const f of files) fd.append('files', f);

  const r=await fetch('/api/admin/banners',{method:'POST',headers:staffHeaders(),body:fd});
  if(!r.ok) return alert('ÙØ´Ù„');
  loadAll();
}

async function delBanner(id){
  if(!confirm('ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ')) return;
  await fetch('/api/admin/banners/'+id,{method:'DELETE',headers:staffHeaders()});
  loadAll();
}

async function addPackage(){
  const t = document.getElementById('pkgTitle').value.trim();
  const d = document.getElementById('pkgDesc').value.trim();
  const f = document.getElementById('pkgFile').files[0];

  if(!t || !f) return alert('Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ØµÙˆØ±Ø© Ù…Ø·Ù„ÙˆØ¨Ø©');

  const fd = new FormData();
  fd.append('file', f);
  fd.append('title', t);
  fd.append('desc', d);

  const r = await fetch('/api/admin/packages',{
    method:'POST',
    headers: staffHeaders(),
    body: fd
  });

  if(!r.ok) return alert('ÙØ´Ù„');
  loadAll();
}

async function delPackage(id){
  if(!confirm('ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ')) return;
  await fetch('/api/admin/packages/'+id,{method:'DELETE',headers:staffHeaders()});
  loadAll();
}
// ================= CLINICS ADMIN =================
let currentClinicId = null;

async function openClinicEdit(id){
  const r = await fetch('/api/admin/clinics', { headers: staffHeaders() });
  const data = await r.json();
  const c = (data.clinics || []).find(x => x.id === id);
  if(!c) return alert('Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');

  currentClinicId = id;

  eLabel.value = c.label;
  eValue.value = c.value;
  eFrom.value  = c.from;
  eTo.value    = c.to;
  eFriday.checked   = !!c.allowFriday;
  eSaturday.checked = !!c.allowSaturday;

  panelC.classList.remove('active');
  panelEditClinic.classList.add('active');
}
async function saveClinicEdit(){
  const payload = {
    label: eLabel.value,
    value: eValue.value,
    from:  eFrom.value,
    to:    eTo.value,
    allowFriday: eFriday.checked,
    allowSaturday: eSaturday.checked
  };

  const r = await fetch('/api/admin/clinics/' + currentClinicId, {
    method:'PUT',
    headers:{ ...staffHeaders(), 'Content-Type':'application/json' },
    body: JSON.stringify(payload)
  });

  if(!r.ok) return alert('ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«');

  backToClinics();
  loadClinicsAdmin();
}

function backToClinics(){
  panelEditClinic.classList.remove('active');
  panelC.classList.add('active');
}




async function loadClinicsAdmin(){
  const r = await fetch('/api/admin/clinics', { headers: staffHeaders() });
  const data = await r.json();
  renderClinics(data.clinics || []);
}

function renderClinics(list){
  const el = document.getElementById('clinics');
  el.innerHTML = '';
  list.forEach(c=>{
    const card = document.createElement('div');
    card.className = 'card';
  card.innerHTML = `
  <div class="title">${c.label}</div>
  <div class="sub">${c.from} â€“ ${c.to}</div>

  <div class="sub" style="margin-top:6px">
    Ø§Ù„Ø¬Ù…Ø¹Ø©:
    <strong style="color:${c.allowFriday ? 'âœ”ï¸' : 'âŒ'}">
      ${c.allowFriday ? 'Ù…Ø³Ù…ÙˆØ­' : 'ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­'}
    </strong>
    <br>
    Ø§Ù„Ø³Ø¨Øª:
    <strong style="color:${c.allowSaturday ? 'âœ”ï¸' : 'âŒ'}">
      ${c.allowSaturday ? 'Ù…Ø³Ù…ÙˆØ­' : 'ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­'}
    </strong>
  </div>

 <button class="btn" onclick="openClinicEdit('${c.id}')">ØªØ¹Ø¯ÙŠÙ„</button>

  <button class="btn danger" onclick="delClinic('${c.id}')">Ø­Ø°Ù</button>
`;


    el.appendChild(card);
  });
}


async function addClinic(){
  const payload = {
    label: cLabel.value,
    value: cValue.value,
    from:  cFrom.value,
    to:    cTo.value,
    allowFriday: document.getElementById('cAllowFriday').checked,
    allowSaturday: document.getElementById('cAllowSaturday').checked
  };

  await fetch('/api/admin/clinics',{
    method:'POST',
    headers:{ ...staffHeaders(),'Content-Type':'application/json' },
    body: JSON.stringify(payload)
  });

  loadClinicsAdmin();
}



async function delClinic(id){
  if(!confirm('ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ')) return;
  await fetch('/api/admin/clinics/'+id,{
    method:'DELETE',
    headers: staffHeaders()
  });
  loadClinicsAdmin();
}

</script>
<script>
  async function loadDoctors(){
  const r = await fetch('/api/admin/doctors',{headers:staffHeaders()});
  const d = await r.json();
  renderDoctors(d.doctors||[]);
}

function renderDoctors(list){
  const el = document.getElementById('doctors');
  el.innerHTML='';
  list.forEach(x=>{
    el.innerHTML+=`
      <div class="card">
        <img src="${x.img}">
        <div class="title">${x.name}</div>
        <div class="sub">${x.desc}</div>
        <button class="btn danger" onclick="delDoctor('${x.id}')">Ø­Ø°Ù</button>
      </div>`;
  });
}

async function addDoctor(){
  const fd = new FormData();
  fd.append('file', docFile.files[0]);
  fd.append('name', docName.value);
  fd.append('desc', docDesc.value);

  await fetch('/api/admin/doctors',{
    method:'POST',
    headers:staffHeaders(),
    body:fd
  });
  loadDoctors();
}

async function delDoctor(id){
  await fetch('/api/admin/doctors/'+id,{
    method:'DELETE',
    headers:staffHeaders()
  });
  loadDoctors();
}

const REAL_KEY = 'AQZa123@'; // ØºÙŠØ±Ù‡

const input = document.getElementById('key');
const app   = document.getElementById('adminApp');

input.addEventListener('input', () => {
  const ok = input.value === REAL_KEY;
  app.style.display = ok ? 'block' : 'none';

  if (ok) {
    loadAll();

    // ğŸ”¥ Ø§ÙØªØ­ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
    tabC.classList.add('active');
    tabB.classList.remove('active');
    tabP.classList.remove('active');

    panelC.classList.add('active');
    panelB.classList.remove('active');
    panelP.classList.remove('active');
  }
});

</script>

</body>
</html>
