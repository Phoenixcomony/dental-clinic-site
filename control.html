<!DOCTYPE html>

<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>لوحة التحكم | فينكس</title>

  <!-- Google Font -->

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f7f9;
      --card:#ffffff;
      --text:#111111;
      --muted:#6b7280;
      --border:#e5e7eb;
      --primary:#111111;
      --danger:#b00000;
      --radius:16px;
      --shadow:0 10px 30px rgba(0,0,0,.06);
      --shadow-soft:0 6px 18px rgba(0,0,0,.05);
    }

    *{box-sizing:border-box}

    body{
      font-family:'Cairo',Arial,sans-serif;
      background:var(--bg);
      margin:0;
      color:var(--text);
    }

    .wrap{
      max-width:1200px;
      margin:32px auto;
      padding:20px;
    }

    /* ===== Header ===== */
    .header{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:20px 24px;
      display:flex;
      flex-direction:column;
      gap:14px;
      margin-bottom:20px;
    }

    .header-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:12px;
    }

    .title{
      font-size:22px;
      font-weight:700;
    }

    .auth-box{
      display:flex;
      align-items:center;
      gap:10px;
      background:#fafafa;
      border:1px solid var(--border);
      border-radius:999px;
      padding:6px 12px;
    }

    .auth-box span{font-size:14px;color:var(--muted)}

    .auth-box input{
      border:none;
      outline:none;
      background:transparent;
      font-family:inherit;
      padding:6px 8px;
      width:160px;
    }

    /* ===== Tabs ===== */
    .tabs{
      display:flex;
      gap:10px;
      background:#f0f1f3;
      padding:6px;
      border-radius:999px;
      width:fit-content;
    }

    .tabs button{
      border:none;
      background:transparent;
      padding:10px 22px;
      border-radius:999px;
      cursor:pointer;
      font-family:inherit;
      font-size:14px;
      color:var(--muted);
      transition:.25s ease;
    }

    .tabs button.active{
      background:var(--primary);
      color:#fff;
      box-shadow:var(--shadow-soft);
    }

    /* ===== Panels ===== */
    .panel{
      display:none;
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:22px;
      margin-top:20px;
      animation:fade .4s ease;
    }

    .panel.active{display:block}

    @keyframes fade{
      from{opacity:0;transform:translateY(10px)}
      to{opacity:1;transform:translateY(0)}
    }

    .panel h3{
      margin:0 0 6px;
      font-size:18px;
    }

    .panel .desc{
      font-size:13px;
      color:var(--muted);
      margin-bottom:16px;
    }

    /* ===== Forms ===== */
    .form-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:14px;
    }

    input[type="text"], input[type="password"], input[type="file"]{
      padding:10px 12px;
      border-radius:10px;
      border:1px solid var(--border);
      font-family:inherit;
      background:#fafafa;
    }

    /* ===== Buttons ===== */
    .btn{
      padding:10px 16px;
      border-radius:10px;
      border:1px solid var(--border);
      background:#fff;
      cursor:pointer;
      font-family:inherit;
      transition:.25s ease;
    }

    .btn:hover{transform:translateY(-1px)}

    .btn.primary{
      background:var(--primary);
      color:#fff;
      border-color:var(--primary);
    }

    .btn.danger{
      background:#ffeded;
      border:1px solid #ffd1d1;
      color:var(--danger);
    }

    /* ===== Grid ===== */
    .row{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(190px,1fr));
      gap:16px;
      margin-top:18px;
    }

    /* ===== Cards ===== */
    .card{
      background:#fff;
      border-radius:14px;
      box-shadow:var(--shadow-soft);
      padding:10px;
      position:relative;
      overflow:hidden;
      transition:.3s ease;
    }

    .card:hover{
      transform:translateY(-6px);
      box-shadow:0 18px 45px rgba(0,0,0,.08);
    }

    .card img{
      width:100%;
      height:150px;
      object-fit:contain;
      background:#fafafa;
      border-radius:10px;
    }

    .card .title{
      font-size:14px;
      font-weight:700;
      margin-top:8px;
    }

    .card .sub{
      font-size:12px;
      color:var(--muted);
    }

    .card .danger{
      position:absolute;
      top:8px;
      left:8px;
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
    }

    @media(max-width:600px){
      .auth-box{width:100%;justify-content:space-between}
      .tabs{width:100%}
      .tabs button{flex:1}
    }

  </style>

</head>
<body>

<div class="wrap">
  <!-- مفتاح الدخول (ظاهر دائمًا) -->
<div class="auth-box">
  <span></span>
  <input id="key" type="password" placeholder="STAFF_KEY">
</div>

<!-- المحتوى المقفل -->
<div id="adminApp" style="display:none">


  <!-- Header -->

  <div class="header">
    <div class="header-top">
      <div class="title">لوحة التحكم الإدارية – مجمع فينكس الطبي</div>
      


<div class="tabs">
  <button id="tabB" class="active">البنرات</button>
  <button id="tabP">الباقات</button>
  <button id="tabC">العيادات</button>
</div>



  </div>

  <!-- البنرات -->

  <section id="panelB" class="panel active">
    <h3>إدارة البنرات</h3>
    <div class="desc">رفع – عرض – حذف البنرات بشكل مباشر</div>


<div class="form-row">
  <input id="bannerFile" type="file" accept="image/*" multiple>
  <button class="btn primary" onclick="addBanner()">حفظ البنرات</button>
</div>

<div id="banners" class="row"></div>


  </section>

  <!-- الباقات -->

  <section id="panelP" class="panel">
    <h3>إدارة الباقات</h3>
    <div class="desc">إضافة – تعديل – حذف الباقات التسويقية</div>
<!-- العيادات -->
<section id="panelC" class="panel">
  <h3>إدارة العيادات</h3>
  <div class="desc">إضافة – تحديد وقت – حذف العيادات</div>

  <div class="form-row">
    <input id="cLabel" type="text" placeholder="اسم العيادة">
    <input id="cValue" type="text" placeholder="قيمة الحجز (Imdad)">
    <input id="cFrom" type="time">
    <input id="cTo" type="time">
    <button class="btn primary" onclick="addClinic()">حفظ العيادة</button>
  </div>

  <div id="clinics" class="row"></div>
</section>


<div class="form-row">
  <input id="pkgTitle" type="text" placeholder="عنوان الباقة">
  <input id="pkgDesc" type="text" placeholder="وصف مختصر">
  <input id="pkgFile" type="file" accept="image/*">
  <button class="btn primary" onclick="addPackage()">حفظ الباقة</button>
</div>

<div id="packages" class="row"></div>


  </section>

</div>
</div> <!-- نهاية adminApp -->

<script>
const tabB = document.getElementById('tabB');
const tabP = document.getElementById('tabP');
const panelB = document.getElementById('panelB');
const panelP = document.getElementById('panelP');
const tabC = document.getElementById('tabC');
const panelC = document.getElementById('panelC');


tabB.onclick=()=>{
  tabB.classList.add('active');
  tabP.classList.remove('active');
  panelB.classList.add('active');
  panelP.classList.remove('active')
}

tabP.onclick=()=>{
  tabP.classList.add('active');
  tabB.classList.remove('active');
  panelP.classList.add('active');
  panelB.classList.remove('active')
}
tabC.onclick=()=>{
  tabC.classList.add('active');
  tabB.classList.remove('active');
  tabP.classList.remove('active');
  panelC.classList.add('active');
  panelB.classList.remove('active');
  panelP.classList.remove('active');
}

function staffHeaders(){
  return { 'x-staff-key': document.getElementById('key').value };
}

async function loadAll(){
  const b = await fetch('/api/banners').then(r=>r.json());
  const p = await fetch('/api/packages').then(r=>r.json());
  renderBanners(b.banners||[]);
  renderPackages(p.packages||[]);
  loadClinicsAdmin();
}
loadAll();

function renderBanners(list){
  const el = document.getElementById('banners'); el.innerHTML='';
  list.forEach(x=>{
    const c=document.createElement('div'); c.className='card';
    c.innerHTML=`<img src="${x.src}"><button class="btn danger" onclick="delBanner('${x.id}')">حذف</button>`;
    el.appendChild(c);
  });
}

function renderPackages(list){
  const el = document.getElementById('packages'); el.innerHTML='';
  list.forEach(x=>{
    const c=document.createElement('div'); c.className='card';
    c.innerHTML=`<img src="${x.img}">
      <div class="title">${x.title}</div>
      <div class="sub">${x.desc||''}</div>
      <button class="btn danger" onclick="delPackage('${x.id}')">حذف</button>`;
    el.appendChild(c);
  });
}

async function addBanner(){
  const files = document.getElementById('bannerFile').files;
  if(!files.length) return alert('اختر صورة أو أكثر');

  const fd = new FormData();
  for (const f of files) fd.append('files', f);

  const r=await fetch('/api/admin/banners',{method:'POST',headers:staffHeaders(),body:fd});
  if(!r.ok) return alert('فشل');
  loadAll();
}

async function delBanner(id){
  if(!confirm('تأكيد الحذف؟')) return;
  await fetch('/api/admin/banners/'+id,{method:'DELETE',headers:staffHeaders()});
  loadAll();
}

async function addPackage(){
  const t = document.getElementById('pkgTitle').value.trim();
  const d = document.getElementById('pkgDesc').value.trim();
  const f = document.getElementById('pkgFile').files[0];

  if(!t || !f) return alert('العنوان والصورة مطلوبة');

  const fd = new FormData();
  fd.append('file', f);
  fd.append('title', t);
  fd.append('desc', d);

  const r = await fetch('/api/admin/packages',{
    method:'POST',
    headers: staffHeaders(),
    body: fd
  });

  if(!r.ok) return alert('فشل');
  loadAll();
}

async function delPackage(id){
  if(!confirm('تأكيد الحذف؟')) return;
  await fetch('/api/admin/packages/'+id,{method:'DELETE',headers:staffHeaders()});
  loadAll();
}
// ================= CLINICS ADMIN =================

async function loadClinicsAdmin(){
  const r = await fetch('/api/admin/clinics', { headers: staffHeaders() });
  const data = await r.json();
  renderClinics(data.clinics || []);
}

function renderClinics(list){
  const el = document.getElementById('clinics');
  el.innerHTML = '';
  list.forEach(c=>{
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <div class="title">${c.label}</div>
      <div class="sub">${c.from} – ${c.to}</div>
      <button class="btn danger" onclick="delClinic('${c.id}')">حذف</button>
    `;
    el.appendChild(card);
  });
}

async function addClinic(){
  const payload = {
    label: cLabel.value,
    value: cValue.value,
    from: cFrom.value,
    to: cTo.value
  };

  const r = await fetch('/api/admin/clinics',{
    method:'POST',
    headers:{ ...staffHeaders(), 'Content-Type':'application/json' },
    body: JSON.stringify(payload)
  });

  if(!r.ok) return alert('فشل الإضافة');

  cLabel.value = '';
  cValue.value = '';
  cFrom.value  = '';
  cTo.value    = '';

  loadClinicsAdmin();
}

async function delClinic(id){
  if(!confirm('تأكيد الحذف؟')) return;
  await fetch('/api/admin/clinics/'+id,{
    method:'DELETE',
    headers: staffHeaders()
  });
  loadClinicsAdmin();
}

</script>
<script>
const REAL_KEY = 'AQZa123@'; // غيره

const input = document.getElementById('key');
const app   = document.getElementById('adminApp');

input.addEventListener('input', () => {
  app.style.display = input.value === REAL_KEY ? 'block' : 'none';
});
</script>

</body>
</html>
